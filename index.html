<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#007BFF">
  <link rel="stylesheet" href="css/theme.css">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
  <title data-i18n="app.title">J1hub Experience Hub</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--theme-background);
      color: var(--theme-text);
    }

    header {
      text-align: center;
      padding: 2rem 1rem 1rem;
      background: linear-gradient(135deg, var(--theme-gradient-start), var(--theme-gradient-end));
      color: var(--theme-header-text);
      box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3);
      border-bottom-left-radius: 18px;
      border-bottom-right-radius: 18px;
    }

    header h1 {
      margin: 0;
      font-size: 1.9rem;
      letter-spacing: 0.02em;
    }

    .search-container {
      margin: 1.5rem auto 0;
      max-width: 460px;
      position: relative;
    }

    .search-container input[type='search'] {
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: 999px;
      border: none;
      font-size: 1rem;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.15);
      outline: none;
      transition: box-shadow 0.2s ease;
      background: #fff;
    }

    .search-container input[type='search']:focus {
      box-shadow: 0 0 0 3px var(--theme-focus-ring),
        0 12px 20px rgba(15, 23, 42, 0.18);
    }

    .filter-chip {
      border: none;
      border-radius: 999px;
      background: var(--theme-chip-bg);
      color: var(--theme-chip-text);
      font-weight: 600;
      padding: 0.45rem 1rem;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .language-toggle {
      margin: 0.75rem auto 0;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.25rem;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 999px;
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.18);
    }

    .language-toggle button {
      background: transparent;
      border: none;
      border-radius: 999px;
      color: #fff;
      font-weight: 600;
      padding: 0.35rem 0.9rem;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .language-toggle button:hover,
    .language-toggle button:focus {
      background: var(--theme-chip-hover);
      transform: translateY(-1px);
    }

    .language-toggle button.is-active {
      background: var(--theme-primary-dark);
      color: #fff;
    }

    .filter-chip:hover,
    .filter-chip:focus {
      background: var(--theme-chip-hover);
      transform: translateY(-1px);
    }

    .filter-chip.is-active {
      background: var(--theme-primary-dark);
      color: var(--theme-header-text);
    }

    .tablist {
      margin: 1.25rem auto 0;
      display: flex;
      gap: 0.65rem;
      justify-content: center;
      flex-wrap: wrap;
      max-width: 520px;
    }

    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }

    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.5rem 1rem 3.5rem;
    }

    .results-meta {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 1rem;
      color: var(--theme-primary-dark);
      font-weight: 600;
    }

    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1.5rem;
    }

    .hotel-card,
    .resource-card {
      background: #fff;
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .hotel-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 18px 32px rgba(15, 23, 42, 0.12);
    }

    .hotel-card-main {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1.5rem;
      text-decoration: none;
      color: inherit;
    }

    .hotel-card-main:focus-visible {
      outline: 3px solid var(--theme-primary);
      outline-offset: 4px;
      border-radius: 12px;
    }

    .hotel-details {
      flex: 1 1 auto;
    }

    .hotel-card h2,
    .resource-card h2 {
      margin: 0 0 0.5rem;
      font-size: 1.3rem;
      color: var(--theme-card-title);
    }

    .hotel-meta,
    .resource-meta {
      margin: 0.4rem 0;
      font-size: 0.95rem;
      line-height: 1.4;
    }

    a.hotel-link,
    a.resource-link {
      display: inline-block;
      margin-top: 0.8rem;
      padding: 0.55rem 0.9rem;
      background: var(--theme-primary);
      color: var(--theme-header-text);
      text-decoration: none;
      border-radius: 999px;
      font-size: 0.9rem;
      font-weight: 600;
      transition: background 0.2s ease;
    }

    a.hotel-link:hover,
    a.hotel-link:focus,
    a.resource-link:hover,
    a.resource-link:focus {
      background: var(--theme-primary-dark);
    }

    .hotel-qr {
      flex: 0 0 auto;
      display: flex;
      align-items: center;
    }

    .hotel-qr img {
      width: 100px;
      height: 100px;
      border-radius: 8px;
      box-shadow: 0 8px 16px rgba(15, 23, 42, 0.08);
    }

    .hotel-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .action-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.55rem 0.9rem;
      border-radius: 999px;
      background: var(--theme-primary);
      color: var(--theme-header-text);
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 600;
      min-height: 44px;
      min-width: 88px;
      transition: background 0.2s ease;
    }

    .action-button:hover,
    .action-button:focus {
      background: var(--theme-primary-dark);
    }

    .tag-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-top: 0.6rem;
    }

    .tag {
      background: var(--theme-tag-bg);
      color: var(--theme-tag-text);
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .resume-orientation {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      margin: 1.5rem auto 0;
      padding: 0.75rem 1.5rem;
      border-radius: 999px;
      border: none;
      background: var(--theme-primary);
      color: var(--theme-header-text);
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.16);
    }

    .resume-orientation:hover,
    .resume-orientation:focus {
      background: var(--theme-primary-dark);
      transform: translateY(-1px);
    }

    .resume-orientation:focus-visible {
      outline: 3px solid var(--theme-focus-ring-outline);
      outline-offset: 4px;
    }

    .onboarding-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.45);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      z-index: 999;
    }

    .onboarding-backdrop[hidden] {
      display: none;
    }

    .onboarding-modal {
      background: var(--theme-modal-bg);
      color: var(--theme-text);
      border-radius: 18px;
      width: min(520px, 100%);
      max-height: 90vh;
      overflow: hidden;
      box-shadow: 0 24px 48px rgba(15, 23, 42, 0.2);
      display: flex;
      flex-direction: column;
    }

    .onboarding-modal header {
      background: linear-gradient(135deg, var(--theme-gradient-start), var(--theme-gradient-end));
      color: var(--theme-header-text);
      padding: 1.5rem 1.5rem 1rem;
      text-align: left;
      border-radius: 18px 18px 0 0;
      box-shadow: none;
    }

    .onboarding-modal header h2 {
      margin: 0;
      font-size: 1.5rem;
    }

    .onboarding-modal header p {
      margin: 0.5rem 0 0;
      font-weight: 500;
    }

    .onboarding-modal main {
      padding: 1.5rem;
      overflow-y: auto;
    }

    .onboarding-modal footer {
      padding: 1rem 1.5rem 1.5rem;
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
    }

    .onboarding-progress {
      font-weight: 600;
      color: var(--theme-primary-dark);
      margin-bottom: 1rem;
    }

    .onboarding-task-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .onboarding-task {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      padding: 1rem;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.8);
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.08);
    }

    .onboarding-task-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .onboarding-task label {
      font-weight: 600;
      flex: 1;
    }

    .onboarding-task small {
      color: var(--theme-primary);
      font-weight: 600;
    }

    .onboarding-actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .onboarding-actions a {
      text-decoration: none;
      background: var(--theme-primary);
      color: var(--theme-header-text);
      padding: 0.4rem 0.8rem;
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.85rem;
      transition: background 0.2s ease;
    }

    .onboarding-actions a:hover,
    .onboarding-actions a:focus {
      background: var(--theme-primary-dark);
    }

    .onboarding-close {
      border: none;
      border-radius: 999px;
      padding: 0.6rem 1rem;
      font-weight: 600;
      background: var(--theme-chip-bg);
      color: var(--theme-text);
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .onboarding-close:hover,
    .onboarding-close:focus {
      background: var(--theme-chip-hover);
    }

    @media (max-width: 600px) {
      header {
        padding: 1.8rem 1rem 1rem;
      }

      header h1 {
        font-size: 1.6rem;
      }

      .search-container {
        margin-top: 1.2rem;
      }

      .tablist {
        gap: 0.5rem;
        margin-top: 1rem;
      }

      .card-grid {
        padding: 0.25rem;
        gap: 1rem;
      }

      .hotel-card,
      .resource-card {
        padding: 1.2rem;
      }

      .hotel-card-main {
        flex-direction: column;
      }

      .hotel-qr {
        width: 100%;
        justify-content: flex-start;
      }

      .hotel-actions {
        width: 100%;
        justify-content: flex-start;
      }
    }
  </style>
</head>
<body>
  <script>
    (function () {
      const router = (window.__J1Router = {});
      const params = new URLSearchParams(window.location.search);
      const propParam = (params.get('prop') || '').trim();
      const langParam = (params.get('lang') || '').trim();

      function applyThemeClass(propertyCode) {
        if (!propertyCode || !document.body) {
          return;
        }
        const existing = Array.from(document.body.classList);
        existing.forEach((className) => {
          if (/^theme-/i.test(className)) {
            document.body.classList.remove(className);
          }
        });
        document.body.classList.add(`theme-${propertyCode}`);
      }

      let normalizedProp = null;
      try {
        if (propParam) {
          normalizedProp = propParam.toUpperCase();
          localStorage.setItem('prop', normalizedProp);
          router.propFromUrl = normalizedProp;
        } else {
          const storedProp = localStorage.getItem('prop');
          normalizedProp = storedProp ? storedProp.toUpperCase() : null;
        }
      } catch (error) {
        normalizedProp = propParam ? propParam.trim().toUpperCase() : null;
      }

      if (normalizedProp) {
        applyThemeClass(normalizedProp);
      }

      let normalizedLang = null;
      try {
        if (langParam) {
          normalizedLang = langParam.toLowerCase();
          localStorage.setItem('lang', normalizedLang);
          localStorage.setItem('preferredLanguage', normalizedLang);
          router.langFromUrl = normalizedLang;
        } else {
          const storedLang =
            localStorage.getItem('preferredLanguage') || localStorage.getItem('lang');
          normalizedLang = storedLang ? storedLang.toLowerCase() : null;
        }
      } catch (error) {
        normalizedLang = langParam ? langParam.trim().toLowerCase() : null;
      }

      if (normalizedLang) {
        document.documentElement.setAttribute('lang', normalizedLang);
      }
    })();
  </script>
  <header>
    <h1 data-i18n="app.title">🏨 Wisconsin Dells Experience Hub</h1>
    <div
      class="language-toggle"
      role="group"
      aria-label="Select language"
      data-i18n-aria-label="aria.languageToggle"
    >
      <button type="button" data-language="en" class="is-active" aria-pressed="true">
        EN
      </button>
      <button type="button" data-language="es" aria-pressed="false">
        ES
      </button>
      <button type="button" data-language="pt" aria-pressed="false">
        PT
      </button>
    </div>
    <div class="search-container">
      <label
        for="hotel-search"
        class="visually-hidden"
        data-i18n="search.label"
      >
        Search the hub
      </label>
      <input
        type="search"
        id="hotel-search"
        name="hotel-search"
        placeholder="Search the hub…"
        data-i18n-placeholder="search.placeholder"
        autocomplete="off"
      />
    </div>
    <nav
      class="tablist"
      role="tablist"
      aria-label="Resource categories"
      data-i18n-aria-label="aria.tablist"
    >
      <button
        type="button"
        class="filter-chip is-active"
        data-tab="hotels"
        role="tab"
        aria-selected="true"
        aria-controls="results"
        id="tab-hotels"
        data-i18n="tabs.hotels"
      >
        Hotels
      </button>
      <button
        type="button"
        class="filter-chip"
        data-tab="housing"
        role="tab"
        aria-selected="false"
        aria-controls="results"
        id="tab-housing"
        data-i18n="tabs.housing"
      >
        Housing
      </button>
      <button
        type="button"
        class="filter-chip"
        data-tab="resources"
        role="tab"
        aria-selected="false"
        aria-controls="results"
        id="tab-resources"
        data-i18n="tabs.resources"
      >
        Local Resources
      </button>
    </nav>
  </header>
  <main>
    <button type="button" class="resume-orientation" id="resume-orientation" data-i18n="onboarding.resume">
      Resume Orientation
    </button>
    <div class="results-meta" id="results-meta" aria-live="polite"></div>
    <section
      id="results"
      class="card-grid"
      aria-live="polite"
      aria-labelledby="tab-hotels"
    ></section>
  </main>
    <script>
    const state = {
      data: {
        hotels: [],
        housing: [],
        resources: [],
      },
      activeTab: 'hotels',
    };

    const tabConfig = {
      hotels: {
        labelKey: 'tabs.hotels',
        emptyKey: 'messages.no_hotels',
      },
      housing: {
        labelKey: 'tabs.housing',
        emptyKey: 'messages.no_housing',
      },
      resources: {
        labelKey: 'tabs.resources',
        emptyKey: 'messages.no_resources',
      },
    };

    const resultsContainer = document.getElementById('results');
    const resultsMeta = document.getElementById('results-meta');
    const searchInput = document.getElementById('hotel-search');
    const filterButtons = document.querySelectorAll('.filter-chip');
    const languageButtons = document.querySelectorAll('[data-language]');
    languageButtons.forEach((button) => {
      button.disabled = true;
      button.setAttribute('aria-disabled', 'true');
    });

    const i18n = {
      translations: {},
      currentLanguage: 'en',
      supported: ['en', 'es', 'pt'],
    };
    const hub = (window.J1Hub = window.J1Hub || {});
    const languageListeners = new Set();

    function formatTemplate(template, replacements = {}) {
      let result = template;
      Object.entries(replacements).forEach(([token, value]) => {
        const regex = new RegExp(`{${token}}`, 'g');
        result = result.replace(regex, value);
      });
      return result;
    }

    function translate(key, replacements = {}) {
      if (!key) {
        return '';
      }
      const languages = [i18n.currentLanguage, 'en'];
      for (const language of languages) {
        const catalog = i18n.translations?.[language];
        if (catalog && typeof catalog[key] === 'string') {
          return formatTemplate(catalog[key], replacements);
        }
      }
      return formatTemplate(key, replacements);
    }

    hub.translate = (key, replacements = {}) => translate(key, replacements);
    hub.getCurrentLanguage = () => i18n.currentLanguage;
    hub.getTranslations = () => ({ ...i18n.translations });
    hub.onLanguageChange = function (callback) {
      if (typeof callback !== 'function') {
        return () => {};
      }
      languageListeners.add(callback);
      callback(i18n.currentLanguage);
      return () => languageListeners.delete(callback);
    };

    function notifyLanguageChange(language) {
      languageListeners.forEach((listener) => {
        try {
          listener(language);
        } catch (error) {
          console.error('Language listener failed', error);
        }
      });
    }

    function updateLanguageToggle(activeLanguage) {
      languageButtons.forEach((button) => {
        const isActive = button.dataset.language === activeLanguage;
        button.classList.toggle('is-active', isActive);
        button.setAttribute('aria-pressed', String(isActive));
      });
    }

    function enableLanguageButtons() {
      languageButtons.forEach((button) => {
        button.disabled = false;
        button.removeAttribute('aria-disabled');
      });
    }

    function updateStaticText() {
      const textElements = document.querySelectorAll('[data-i18n]');
      textElements.forEach((element) => {
        const key = element.dataset.i18n;
        const translation = translate(key);
        if (translation) {
          element.textContent = translation;
        }
      });

      const placeholderElements = document.querySelectorAll('[data-i18n-placeholder]');
      placeholderElements.forEach((element) => {
        const key = element.dataset.i18nPlaceholder;
        const translation = translate(key);
        if (translation) {
          element.setAttribute('placeholder', translation);
        }
      });

      const ariaLabelElements = document.querySelectorAll('[data-i18n-aria-label]');
      ariaLabelElements.forEach((element) => {
        const key = element.dataset.i18nAriaLabel;
        const translation = translate(key);
        if (translation) {
          element.setAttribute('aria-label', translation);
        }
      });
    }

    function getStoredLanguage() {
      try {
        const stored = localStorage.getItem('preferredLanguage');
        return i18n.supported.includes(stored) ? stored : null;
      } catch (error) {
        return null;
      }
    }

    function persistLanguage(language) {
      try {
        localStorage.setItem('preferredLanguage', language);
      } catch (error) {
        // Ignore persistence errors (e.g., private browsing)
      }
    }

    function setLanguage(language) {
      const normalized = i18n.supported.includes(language) ? language : 'en';
      i18n.currentLanguage = normalized;
      persistLanguage(normalized);
      document.documentElement.setAttribute('lang', normalized);
      updateLanguageToggle(normalized);
      updateStaticText();
      renderActiveTab(searchInput ? searchInput.value : '');
      notifyLanguageChange(normalized);
    }

    function slugify(value = '') {
      return value
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/^-+|-+$/g, '');
    }

    function onlyDigits(value = '') {
      return String(value || '').replace(/\D+/g, '');
    }

    function encodeForURL(value = '') {
      return encodeURIComponent(String(value ?? ''));
    }

    function createLink({
      href,
      text,
      className = 'hotel-link',
      target = '_blank',
      rel = 'noopener noreferrer',
    }) {
      const link = document.createElement('a');
      link.className = className;
      link.href = href;
      link.textContent = text;
      if (target) {
        link.target = target;
      }
      if (rel) {
        link.rel = rel;
      }
      return link;
    }

    function createActionButton({ href, text, ariaLabel, target, rel }) {
      const button = document.createElement('a');
      button.className = 'action-button';
      button.href = href;
      button.textContent = text;
      if (ariaLabel) {
        button.setAttribute('aria-label', ariaLabel);
      }
      if (target) {
        button.target = target;
      }
      if (rel) {
        button.rel = rel;
      }
      return button;
    }

    function renderHotels(hotels) {
      hotels.forEach((hotel) => {
        const name = hotel.name || '';
        const slug = hotel.slug || slugify(name);
        const encodedSlug = encodeURIComponent(slug);
        const detailPath = `hotel.html?id=${encodedSlug}`;
        const absoluteDetailUrl = new URL(detailPath, window.location.href).toString();

        const card = document.createElement('article');
        card.className = 'hotel-card';

        const mainLink = document.createElement('a');
        mainLink.className = 'hotel-card-main';
        mainLink.href = detailPath;
        mainLink.setAttribute('aria-label', translate('aria.viewDetails', { name }));

        const details = document.createElement('div');
        details.className = 'hotel-details';

        const title = document.createElement('h2');
        title.textContent = name;
        details.appendChild(title);

        if (hotel.address) {
          const address = document.createElement('p');
          address.className = 'hotel-meta';
          address.textContent = hotel.address;
          details.appendChild(address);
        }

        if (hotel.phone) {
          const phone = document.createElement('p');
          phone.className = 'hotel-meta';
          phone.textContent = hotel.phone;
          details.appendChild(phone);
        }

        if (hotel.description) {
          const description = document.createElement('p');
          description.className = 'hotel-meta';
          description.textContent = hotel.description;
          details.appendChild(description);
        }

        const qrWrapper = document.createElement('div');
        qrWrapper.className = 'hotel-qr';

        const qrImage = document.createElement('img');
        qrImage.src = `https://chart.googleapis.com/chart?cht=qr&chs=100x100&chl=${encodeForURL(
          absoluteDetailUrl
        )}`;
        qrImage.alt = translate('aria.qrCode', { name });
        qrImage.width = 100;
        qrImage.height = 100;
        qrWrapper.appendChild(qrImage);

        mainLink.appendChild(details);
        mainLink.appendChild(qrWrapper);

        card.appendChild(mainLink);

        const actions = document.createElement('div');
        actions.className = 'hotel-actions';

        const phoneDigits = onlyDigits(hotel.phone || '');
        if (phoneDigits) {
          actions.appendChild(
            createActionButton({
              href: `tel:${phoneDigits}`,
              text: translate('buttons.call'),
              ariaLabel: translate('aria.call', { name }),
            })
          );
        }

        if (hotel.address) {
          const mapLink = `https://www.google.com/maps/search/?api=1&query=${encodeForURL(
            hotel.address
          )}`;
          actions.appendChild(
            createActionButton({
              href: mapLink,
              text: translate('buttons.map'),
              ariaLabel: translate('aria.map', { name }),
              target: '_blank',
              rel: 'noopener noreferrer',
            })
          );
        }

        if (hotel.website) {
          actions.appendChild(
            createActionButton({
              href: hotel.website,
              text: translate('buttons.website'),
              ariaLabel: translate('aria.website', { name }),
              target: '_blank',
              rel: 'noopener noreferrer',
            })
          );
        }

        if (actions.children.length) {
          card.appendChild(actions);
        }

        resultsContainer.appendChild(card);
      });
    }

    function renderHousing(listings) {
      const addressLabel = translate('labels.address');
      const contactLabel = translate('labels.contact');
      const phoneLabel = translate('labels.phone');
      const priceRangeLabel = translate('labels.priceRange');
      const notesLabel = translate('labels.notes');

      listings.forEach((listing) => {
        const card = document.createElement('article');
        card.className = 'resource-card';

        const title = document.createElement('h2');
        title.textContent = listing.name;
        card.appendChild(title);

        const address = document.createElement('p');
        address.className = 'resource-meta';
        address.innerHTML = `<strong>${addressLabel}:</strong> ${listing.address}`;
        card.appendChild(address);

        if (listing.contact) {
          const contact = document.createElement('p');
          contact.className = 'resource-meta';
          contact.innerHTML = `<strong>${contactLabel}:</strong> ${listing.contact}`;
          card.appendChild(contact);
        }

        if (listing.phone) {
          const phone = document.createElement('p');
          phone.className = 'resource-meta';
          phone.innerHTML = `<strong>${phoneLabel}:</strong> ${listing.phone}`;
          card.appendChild(phone);
        }

        if (listing.priceRange) {
          const price = document.createElement('p');
          price.className = 'resource-meta';
          price.innerHTML = `<strong>${priceRangeLabel}:</strong> ${listing.priceRange}`;
          card.appendChild(price);
        }

        if (listing.notes) {
          const notes = document.createElement('p');
          notes.className = 'resource-meta';
          notes.innerHTML = `<strong>${notesLabel}:</strong> ${listing.notes}`;
          card.appendChild(notes);
        }

        if (listing.website) {
          const link = createLink({
            href: listing.website,
            text: translate('buttons.viewDetails'),
            className: 'resource-link',
          });
          card.appendChild(link);
        }

        resultsContainer.appendChild(card);
      });
    }

    function renderResources(resources) {
      const addressLabel = translate('labels.address');
      const phoneLabel = translate('labels.phone');
      const hoursLabel = translate('labels.hours');

      resources.forEach((resource) => {
        const card = document.createElement('article');
        card.className = 'resource-card';

        const title = document.createElement('h2');
        title.textContent = resource.name;
        card.appendChild(title);

        if (resource.category) {
          const tags = document.createElement('div');
          tags.className = 'tag-list';
          resource.category.split(',').forEach((category) => {
            const tag = document.createElement('span');
            tag.className = 'tag';
            tag.textContent = category.trim();
            tags.appendChild(tag);
          });
          card.appendChild(tags);
        }

        if (resource.description) {
          const description = document.createElement('p');
          description.className = 'resource-meta';
          description.textContent = resource.description;
          card.appendChild(description);
        }

        if (resource.address) {
          const address = document.createElement('p');
          address.className = 'resource-meta';
          address.innerHTML = `<strong>${addressLabel}:</strong> ${resource.address}`;
          card.appendChild(address);
        }

        if (resource.phone) {
          const phone = document.createElement('p');
          phone.className = 'resource-meta';
          phone.innerHTML = `<strong>${phoneLabel}:</strong> ${resource.phone}`;
          card.appendChild(phone);
        }

        if (resource.hours) {
          const hours = document.createElement('p');
          hours.className = 'resource-meta';
          hours.innerHTML = `<strong>${hoursLabel}:</strong> ${resource.hours}`;
          card.appendChild(hours);
        }

        if (resource.website) {
          const link = createLink({
            href: resource.website,
            text: translate('buttons.visitWebsite'),
            className: 'resource-link',
          });
          card.appendChild(link);
        }

        resultsContainer.appendChild(card);
      });
    }

    function getActiveData() {
      return state.data[state.activeTab] || [];
    }

    function updateMeta(count) {
      const tab = tabConfig[state.activeTab];
      const labelKey = tab?.labelKey || 'labels.listings';
      const label = translate(labelKey);
      resultsMeta.textContent = translate('results.meta', {
        count,
        label,
      });
    }

    function renderActiveTab(query = '') {
      const normalizedQuery = query.trim().toLowerCase();
      const data = getActiveData();
      resultsContainer.innerHTML = '';

      const filtered = !normalizedQuery
        ? data
        : data.filter((item) => {
            const haystack = [
              item.name,
              item.address,
              item.phone,
              item.category,
              item.description,
              item.notes,
              item.contact,
              item.slug,
            ]
              .filter(Boolean)
              .join(' ')
              .toLowerCase();
            return haystack.includes(normalizedQuery);
          });

      if (!filtered.length) {
        const tab = tabConfig[state.activeTab];
        const messageKey = tab?.emptyKey || 'messages.no_results';
        const emptyMessage = translate(messageKey);
        const messageElement = document.createElement('p');
        messageElement.style.color = 'var(--theme-primary)';
        messageElement.style.fontWeight = '600';
        messageElement.textContent = emptyMessage;
        resultsContainer.appendChild(messageElement);
        updateMeta(0);
        return;
      }

      if (state.activeTab === 'hotels') {
        renderHotels(filtered);
      } else if (state.activeTab === 'housing') {
        renderHousing(filtered);
      } else {
        renderResources(filtered);
      }

      updateMeta(filtered.length);
    }

    async function fetchJson(url) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(`Failed to load ${url}: ${response.status}`);
      }
      return response.json();
    }

    async function loadTranslations() {
      const data = await fetchJson('translations.json');
      i18n.translations = data || {};
      const storedLanguage = getStoredLanguage();
      const browserLanguage = (navigator.language || '').split('-')[0].toLowerCase();
      const initialLanguage =
        storedLanguage ||
        (i18n.supported.includes(browserLanguage) ? browserLanguage : 'en');
      setLanguage(initialLanguage);
      enableLanguageButtons();
    }

    async function loadData() {
      try {
        const [hotels, housing, resources] = await Promise.all([
          fetchJson('hotels.json'),
          fetchJson('housing.json'),
          fetchJson('resources.json'),
        ]);
        state.data.hotels = hotels.map((hotel) => ({
          ...hotel,
          slug: hotel.slug ? hotel.slug : slugify(hotel.name || ''),
        }));
        state.data.housing = housing;
        state.data.resources = resources;
        renderActiveTab(searchInput ? searchInput.value : '');
      } catch (error) {
        resultsContainer.innerHTML = '';
        const messageElement = document.createElement('p');
        messageElement.style.color = '#dc2626';
        messageElement.style.fontWeight = '600';
        messageElement.textContent = translate('messages.data_error', {
          message: error.message,
        });
        resultsContainer.appendChild(messageElement);
        resultsMeta.textContent = translate('messages.unable_to_load');
      }
    }

    if (searchInput) {
      searchInput.addEventListener('input', (event) => {
        renderActiveTab(event.target.value);
      });
    }

    filterButtons.forEach((button) => {
      button.addEventListener('click', () => {
        if (button.dataset.tab === state.activeTab) {
          return;
        }

        state.activeTab = button.dataset.tab;
        filterButtons.forEach((btn) => {
          const isActive = btn === button;
          btn.classList.toggle('is-active', isActive);
          btn.setAttribute('aria-selected', String(isActive));
        });

        const activeTabId = button.getAttribute('id');
        if (activeTabId) {
          resultsContainer.setAttribute('aria-labelledby', activeTabId);
        }

        renderActiveTab(searchInput ? searchInput.value : '');
      });
    });

    languageButtons.forEach((button) => {
      button.addEventListener('click', () => {
        const language = button.dataset.language;
        if (language) {
          setLanguage(language);
        }
      });
    });

    async function initialize() {
      try {
        await loadTranslations();
      } catch (error) {
        console.error('Failed to load translations:', error);
        i18n.translations = {};
        setLanguage('en');
      }
      await loadData();
    }

    initialize();
  </script>
  <script type="module" src="js/onboarding.js"></script>
</body>
</html>

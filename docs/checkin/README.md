# Event Check-in Webhook (Google Apps Script)

This guide explains how to deploy the `apps-script/Code.gs` webhook so staff scanners can send attendee check-ins directly into a Google Sheet.

## Prerequisites

- A Google account with access to Google Drive and Google Sheets.
- A new or existing Google Sheet where check-ins will be stored.

## Set up the Google Sheet

1. Create a new Google Sheet named something like **J1hub Event Check-ins**.
2. Add a sheet tab titled **Check-ins**.
3. In the first row add the headers: `Timestamp`, `Event`, `User`, `User Agent`, `IP`.

## Deploy the Apps Script Web App

1. In the Sheet, open **Extensions → Apps Script**. This opens the Apps Script editor.
2. Delete the placeholder code and paste the contents of [`apps-script/Code.gs`](../../apps-script/Code.gs).
3. Click **Save** and give the project a name (for example, `J1hub Check-in Webhook`).
4. Select **Deploy → Test deployments… → Select type → Web app** (or **Deploy → New deployment** in the old UI).
5. Configure the deployment:
   - **Description:** `Initial deployment`.
   - **Web app > Execute as:** `Me`.
   - **Web app > Who has access:** `Anyone` (or `Anyone with Google account` if authentication is required for your workflow).
6. Click **Deploy**. Approve the authorization prompts when asked.
7. Copy the **Web app URL**. This is the endpoint that scanner clients will POST to.

## Testing the endpoint

Use `curl` (or similar) to verify the deployment is working. Replace `<WEB_APP_URL>` with the URL from the deployment screen.

```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -d '{"type":"checkin","event":"eng-clinic","user":"anon-1234","userAgent":"Scanner-App/1.0"}' \
  "<WEB_APP_URL>"
```

A successful response returns JSON similar to:

```json
{"ok":true}
```

## Connecting the scanner page

- Configure the staff scanner page to send a `POST` request to the deployed URL with a JSON body that matches the payload generated by the attendee QR codes.
- Each payload must include `type`, `event`, and `user`. Optional fields (`userAgent`) can help with audit trails.
- Logged rows appear instantly in the `Check-ins` tab with the timestamp, event, user ID, user agent, and origin IP address.

## Updating the script

When you make changes to `Code.gs`, open **Deploy → Manage deployments**, select the existing deployment, and choose **Edit** → **Deploy** to push a new version. The URL stays the same.
